/*
 
 Panorado JS - Panoramic Viewer for HTML
 (c) 2012 by Karl Maloszek - Simple Software
 http://www.panorado.com/en/PanoradoJs.php
 Use is free on private (non-commercial) websites.
 This is not public domain software!
 Comments are welcome.

*/
function PanoradoJS(nc){var wb,oc,Mb,$a,u,ab,pc,bb,cb,fa,xb,B,yb,L,ga,ha,za,F,zb,V,db,Ab,Wb;function Bb(){G();setTimeout(function(){alert("Panorado JS v."+wb+"\n"+oc)},10);i()}function qc(a){e&&b&&b.clearRect(0,0,e.width,e.height);e=b=null;a&&a.getContext&&(e=a,b=e.getContext("2d"),e.getContext("experimental-webgl"),e.setAttribute("tabindex",0),e.style["-ms-touch-action"]="none",e.style["-ms-content-zooming"]="none",e.addEventListener("keydown",Lc,!1),rc($),e.addEventListener("focus",function(){Aa=
!0;i()},!0),e.addEventListener("blur",function(){Aa=!1;i()},!0),window.addEventListener("resize",eb,!1),eb(),M(Ba),M(fb),M(gb),M(ia),N(),sc(),i(),N(),H.create())}function hb(){Ga();i()}function Ga(){if(c)j=c.pan,k=c.tilt,g=c.scale,W=O=Cb=ja=n=l=0,P=!1,w=C=0,D=Q()}function G(){Ha&&(clearTimeout(Ha),Ha=0);W=ja=n=l=0;w=Q()}function m(){return R==Mb}function Q(){return(new Date).getTime()}function tc(a){aa&&(0>a?a=0:a>=aa.length-1&&(a=aa.length-1),a!=X&&(uc(aa[a]),X=a))}function Ia(a){tc(X+a)}function uc(a){Ga();
X=-1;c=null;R=$a;if(a&&a.src){c=Mc(a.src);c.title=a.title?a.title:"";c.projection="spherical"==a.projection?u:ab;x=c.projection;c.horizon=a.horizon?ka(Number(a.horizon),-45,45):0;c.pan=a.pan?Number(a.pan):0;c.tilt=a.tilt?Number(a.tilt):0;c.scale=a.scale?Number(a.scale):1;var b=Number(a.horzFov);c.horzFov=0<b&&360>b?b:360;c.vertFov=0;c.is360=360==c.horzFov;c.panSpeed=a.panSpeed?ib(Number(a.panSpeed)):pc;c.tiltSpeed=a.tiltSpeed?ib(Number(a.tiltSpeed)):0;jb=a.compassNorth?!0:!1;c.compassNorth=a.compassNorth?
Number(a.compassNorth):0;c.compassNorth+=3600;c.compassNorth%=360;ba=[];Db=null;if(a=a.hotspots)for(b=0;b<a.length;b++)ba.push(new Nc(a[b]));c.hotspots=ba;H.create()}i()}function Mc(a){var b=new Image;R=bb;b.onload=function(){c.vertFov=c.horzFov*c.height/c.width;if(180<c.vertFov)c.horzFov*=180/c.vertFov,c.vertFov=180;c.is360=360==c.horzFov;R=Mb;g=c.scale=kb(c.scale);j=c.pan=Ja(c.pan);k=c.tilt=Ka(c.tilt);Ga();N();vc=!1;lb&&lb();i()};b.onerror=function(){R=cb;i()};b.onabort=function(){R=cb;i()};b.src=
a;return b}function la(a,b){wc(j+a,k+b,null)}function wc(a,b,c){D=0;G();P=!1;m()&&("number"==typeof c&&(g=kb(c)),j=a,k=b,i())}function ma(a){P=!1;I(g*a)}function I(a){D=0;G();m()&&(0!=Ca?(Cb=g,O=kb(a),O!=g&&(W=Q(),i())):(a=kb(a),g!=a&&(Xb(g,a),g=a,i())))}function r(a,b){D=0;m()&&(null!==a&&(l=ib(a)),null!==b&&(n=ib(b)),w=Q(),i())}function ib(a){return a<-fa?-fa:a>fa?fa:a}function kb(a){mb=!1;if("number"!=typeof a||0==a){mb=!0;if(m()){var a=c.width,b=c.height,f=e.width,d=e.height;if(x==u){var g;g=
Math.min(c.horzFov,xb)/2;f*=g*B/La(g);g=Math.min(c.vertFov,yb)/2;d*=g*B/La(g);a=Math.min(a*xb/c.horzFov,a);b=Math.min(b*yb/c.vertFov,b)}a=Math.min(f/a,d/b);a=Math.max(a,Eb);a=Math.min(a,Yb)}else a=0;return a}if(a<Eb)return Eb;if(a>Yb)return Yb;b=[0.125,0.125*Math.SQRT2,0.25,0.25*Math.SQRT2,0.5,0.5*Math.SQRT2,1,1*Math.SQRT2,2,2*Math.SQRT2,4,4*Math.SQRT2,8];for(f=0;f<b.length;f++)if(a>0.999*b[f]&&a<1.001*b[f]){a=b[f];break}return a}function Ja(a){if(c.is360)a=(a+36E3)%360;else{var b=xc()/2,f=c.horzFov-
b;b>f?a=c.horzFov/2:a<b?a=b:a>f&&(a=f)}return a}function Ka(a){var b=yc(),f=(c.vertFov-b)/2,d=-f,f=f-c.horizon,d=d-c.horizon;x==u&&c.is360&&(90<=c.vertFov/2-c.horizon&&(f+=b/2),90<=c.vertFov/2+c.horizon&&(d-=b/2));f<d?a=(d+f)/2:a<d?a=d:a>f&&(a=f);return a}function Xb(a,b){if(P&&0<=p){var c=Zb(a)-Zb(b);j+=c;c=$b(a)-$b(b);k+=c}c=g;g=b;j=Ja(j);k=Ka(k);g=c;0==W&&(P=!1)}function Zb(a){a||(a=g);var b=p-e.width/2,f=-(q-e.height/2),d=0;x==u?(a=c.width/c.horzFov*a*L*t(k)-f*Math.sin(k*B),d=j+na(b,a)):d=j+b/
a*c.horzFov/c.width;c.is360&&(0>d?d+=360:360<d&&(d-=360));return d}function $b(a){a||(a=g);var b=p-e.width/2,f=-(q-e.height/2),d=0;x==u?(d=c.width/c.horzFov*a*L,a=d*t(k)-f*Math.sin(k*B),f=d*Math.sin(k*B)+f*t(k),d=na(f,Math.sqrt(b*b+a*a))):d=k+f/a*c.vertFov/c.height;return d}function Fb(a,b){var f,d;if(x==u){f=c.width/c.horzFov*g*L;d=f*t(k)-b*Math.sin(k*B);var e=f*Math.sin(k*B)+b*t(k);f=na(a,d);d=na(e,Math.sqrt(a*a+d*d))}else f=a/g*c.horzFov/c.width,d=k+b/g*c.vertFov/c.height;c.is360&&(0>f?f+=360:
360<f&&(f-=360));return new zc(f,d)}function Ac(a,b){var f,d;f=a-j;c.is360&&(-180>=f?f+=360:180<f&&(f-=360));if(x==u){var i=c.width/c.horzFov*g*L,E=na(La(b),t(f));d=E-k;if(-90>=d||90<d)return null;var l=i/t(d),E=t(E)*l;f=La(f)*E;d=La(d)*i}else d=b-k,f=f/c.horzFov*c.width*g,d=d/c.vertFov*c.height*g;return new zc(e.width/2+f,e.height/2-d)}function xc(){var a=e.width/c.width*c.horzFov/g;x==u?(a=2*Math.atan(a*B/2)*L,a=Math.min(a,xb)):a=Math.min(a,c.horzFov);return a}function yc(){if(!e)return 0;var a=
e.height/c.height*c.vertFov/g;x==u?(a=2*Math.atan(a*B/2)*L,a=Math.min(a,yb)):a=Math.min(a,c.vertFov);return a}function i(a){var Nb;if(m()){var f=w,d=j,i=k;w=Q();var E=!1,E=E|Oc(),E=E|Pc();if(0<=Gb)100<w-ac&&(l=n=0);else{var p=(w-f)/1E3;j+=l*p;k+=n*p}var q;var oa,pa,bc,o,Ma,Da,h=g;0==W||O==Cb||(oa=1+(w-W)/(500*(2<<Ca)),o=Math.log(Cb),Ma=Math.log(O),Da=Math.log(g),pa=1+Math.min(2*Math.abs(o-Da),Math.abs(Ma-Da)+(Ma-Da)*(Ma-Da))/Math.abs(o-Ma)/8,bc=oa*pa,Cb<O?(h*=bc,h>O&&(h=O)):(h/=bc,h<O&&(h=O)),h==
O?(g=h,W=0):W=w);q=h;Xb(g,q);g=q;E|=d!=j;E|=i!=k;Bc();Nb=E=!0}else Nb=!1;if(!a||Nb){if(b){var r;switch(R){case $a:r="No image!";break;case bb:r="Loading image '"+c.title+"' ("+c.src+")...";break;case cb:r="Error loading image '"+c.title+"' ("+c.src+") !"}switch(R){case $a:case bb:case cb:var A=r;if(vc||R!=bb)b.clearRect(0,0,e.width,e.height),b.globalAlpha=1,str="",e.style.fontStyle&&(str+=e.style.fontStyle+" "),e.style.fontVariant&&(str+=e.style.fontVariant+" "),e.style.fontWeight&&(str+=e.style.fontWeight+
" "),str=e.style.fontSize?str+(e.style.fontSize+" "):str+"14px ",str=e.style.fontFamily?str+e.style.fontFamily:str+"sans-serif",b.font=str,b.fillStyle=e.style.color?e.style.color:"#000",b.textBaseline="top",b.fillText(A,20,20);break;case Mb:var Qc=e.width,I=e.height,z;if(e){var L;if(x==u){var $=Math.min(c.horzFov,xb);L=2*La($/2)/(c.horzFov*B)*c.width*g}else L=c.width*g;z=Math.round(Math.min(L,e.width))}else z=0;var M,P;if(x==u){var aa=Math.min(c.vertFov,yb);P=2*La(aa/2)/(c.vertFov*B)*c.height*g}else P=
c.height*g;M=Math.round(Math.min(P,e.height));var y=Math.round((Qc-z)/2),S=Math.round((I-M)/2),qa=y+z,t=S+M;if(x==u){b.globalAlpha=Cc();var V=qa-y,G=t-S,X=Q();if(x!=u)s=null;else{v=cc;dc||(v*=0.5);var ma=Math.min(4/Math.min(c.width/c.horzFov*g,4),2);v*=ma;v=c.horzFov/Math.floor(c.horzFov/v);var J=Math.round(c.horzFov/v);c.is360&&(v=c.horzFov/J);var K=Math.round(c.vertFov/v);180>c.vertFov&&K++;J++;K++;if(!s||s.length!=K)s=Array(K);for(var ga,F,ka=-c.vertFov/2-c.horizon,ua=c.vertFov/2-c.horizon,Na=
0;Na<K;Na++){if(!s[Na]||s[Na].length!=J)s[Na]=Array(J);F=c.vertFov/2-c.horizon-Na*v;F>ua?F=ua:F<ka&&(F=ka);for(var Z=0;Z<J;Z++)ga=Z*v,s[Na][Z]=new Rc(ga,F)}}b.fillStyle=e.style.backgroundColor?e.style.backgroundColor:"#000";b.fillRect(y,S,V,G);var Fa=Fb(0,0),ea=Fb(0,G/2),fa=Fb(V/2,G/2),ha=Fb(V/2,-G/2),la=Fb(0,-G/2);xc();yc();var nb,Y,Oa,Pa;90<Math.abs(ea.x-la.x)?0<Fa.y?(Y=c.horzFov/2,Oa=Math.min(la.y,ha.y),Pa=90):(Y=c.horzFov/2,Oa=-90,Pa=Math.max(ea.y,fa.y)):(Y=Math.max(fa.x,ha.x),Oa=Math.min(la.y,
ha.y),Pa=Math.max(ea.y,fa.y),Y+=v);nb=-Y;Y+=j;nb+=j;c.is360&&(nb=(nb+3600)%360,Y=(Y+3600)%360);-90<Oa&&(Oa-=v);90>Pa&&(Pa+=v);for(var na=nb,sa=Y,Ta=Oa,Ua=Pa,Za=s.length,ab=s[0].length,za=0;za<Za;za++)for(var Aa=0;Aa<ab;Aa++){var T=s[za][Aa];T.valid=!1;if(!(T.tilt<Ta)&&!(T.tilt>Ua)){if(c.is360&&na>=sa){if(T.pan<na&&T.pan>sa)continue}else{if(T.pan<na)continue;if(T.pan>sa)continue}var Ba=Ac(T.pan,T.tilt);if(Ba)T.valid=!0,T.xDisp=Ba.x,T.yDisp=Ba.y}}for(var fb=s.length-1,gb=s[0].length-1,ob=0;ob<fb;ob++)for(var pb=
0;pb<gb;pb++){var Qa=s[ob][pb];if(Qa.valid){var Hb=s[ob][pb+1];if(Hb.valid){var ia=s[ob+1][pb+1];if(ia.valid){var Ib=s[ob+1][pb];if(Ib.valid){var ib=Qa.pan/c.horzFov*c.width,kb=Hb.pan/c.horzFov*c.width,lb=(0.5-(Qa.tilt+c.horizon)/c.vertFov)*c.height,mb=(0.5-(Ib.tilt+c.horizon)/c.vertFov)*c.height,Ra=v/c.horzFov*c.width*g,Sa=v/c.vertFov*c.height*g,ta=new Ob(-Ra,-Sa,e.width+2*Ra,e.height+2*Sa);if(Pb(Qa,ta)||Pb(Hb,ta)||Pb(ia,ta)||Pb(Ib,ta)){var qb=ib,rb=lb,sb=kb,tb=mb,va=Qa.xDisp,wa=Qa.yDisp,Va=Hb.xDisp,
Wa=Hb.yDisp,xa=ia.xDisp,ya=ia.yDisp,Xa=Ib.xDisp,Ya=Ib.yDisp,vb=0<Qa.tilt+c.horizon;dc?(Qb(qb,rb,sb,rb,sb,tb,va,wa,Va,Wa,xa,ya,!0),Qb(qb,rb,sb,tb,qb,tb,va,wa,xa,ya,Xa,Ya,!1)):vb?Qb(qb,rb,sb,tb,qb,tb,va,wa,xa,ya,Xa,Ya):Qb(qb,rb,sb,rb,sb,tb,va,wa,Va,Wa,xa,ya)}}}}}}var X=Q()-X,wb=X+" ms";if(Wb)document.getElementById("debug3").innerHTML=wb}else{var zb=Q();b.globalAlpha=Cc();b.setTransform(1,0,0,1,0,0);var Ea=c.width,db=c.height,Ab=j/c.horzFov*Ea,Bb=(0.5-(k+c.horizon)/c.vertFov)*db,eb=Math.min((qa-y)/
g,Ea),hb=Math.min((t-S)/g,db),ca=Ab-eb/2,ra=Bb-hb/2,Jb=ca+eb,Ga=ra+hb;0>ca&&(c.is360?(ca+=Ea,Jb+=Ea):ca=0);0>ra&&(ra=0);if(Jb<=Ea)b.drawImage(c,ca,ra,Jb-ca,Ga-ra,y,S,qa-y,t-S);else{var Ia=(Ea-ca)*g;b.drawImage(c,ca,ra,Ea-ca,Ga-ra,y,S,Ia,t-S);b.drawImage(c,0,ra,Jb-Ea,Ga-ra,y+Ia,S,qa-y-Ia,t-S)}var Db=Q()-zb+" ms";if(Wb)document.getElementById("debug3").innerHTML=Db}if(da&&ba){b.save();b.globalAlpha=C;Kb=null;for(var Ja=0;Ja<ba.length;Ja++){var Ka=ba[Ja];Ka.paint();!Kb&&Ka.isUnderCursor()&&(Kb=Ka)}b.restore()}b.save();
b.setTransform(1,0,0,1,0,0);b.globalAlpha=1;b.fillStyle=e.style.backgroundColor?e.style.backgroundColor:"#000";var Eb=e.width,Rb=e.height;0<y&&b.fillRect(0,0,y,Rb);qa<Eb&&b.fillRect(qa,0,qa,Rb);0<S&&b.fillRect(y,0,qa-y,S);t<Rb&&b.fillRect(y,t,qa-y,Rb-t);b.restore();if(jb){var Sb,Tb;if(x==u)Sb=e.width/2,Tb=(j-c.compassNorth+3600)%360,Dc(Tb,Sb);else{for(var ub=50/g*(c.horzFov/c.width),Ub=[1,2,5,10,15,30,45,90],Lb=0;Lb<Ub.length;Lb++)if(ub<=Ub[Lb]||Lb==Ub.length-1){ub=Ub[Lb];break}for(var U=j-e.width/
2/g*c.horzFov/c.width,U=U-c.compassNorth,U=Math.round(U/ub)*ub,U=U-ub,U=U+c.compassNorth;(Sb=g*c.width/c.horzFov*(U-j)+e.width/2)<e.width;)Tb=(U-c.compassNorth+36E3)%360,Dc(Math.round(Tb),Sb),U+=ub}}ec&&H.paint();Kb&&1==C&&Kb.paintPopup()}}N()}Nb&&Vb&&Vb();Ha&&(clearTimeout(Ha),Ha=0);(l||n||D||ja||W)&&(Ha=setTimeout(Sc,20))}function Ec(){return i(!0)}function Sc(){window._VIEWERS[Fc].checkPaint()}function Oc(){var a=1E3*Ra;if(0==D)return C=1,!1;if(w<D+a){var b=C;C=(w-D)/a;return C!=b}if(0==c.panSpeed&&
0==c.tiltSpeed)return C=1,D=0,!0;if(c.panSpeed!=l||c.tiltSpeed!=n){C=1;a=(w-D-a-2E3)/4E3;if(0>a)return!0;l=a*c.panSpeed;n=a*c.tiltSpeed;l=0<c.panSpeed?Math.min(c.panSpeed,l):Math.max(c.panSpeed,l);0<c.tiltSpeed?n=Math.min(c.tiltSpeed,n):_tiltspeed=Math.max(c.tiltSpeed,n);return!0}C=1;D=0;return!1}function Cc(){if(!D)return 1;var a=(w-D)/(1E3*Ra);return 0.9<a?1:a}function Pc(){if(0==ja||ja==w)return!1;if(Math.sqrt(l*l+n*n)>0.02/g*c.horzFov/90){var a=1-(w-ja)/(25*(2<<Sa));if(0<a)return l*=a,n*=a,ja=
w,!0}l=n=ja=0;return!1}function Pb(a,b){return a.xDisp>=b.x&&a.xDisp<=b.x+b.cx&&a.yDisp>=b.y&&a.yDisp<=b.y+b.cy}function Qb(a,e,f,d,i,l,k,n,oa,pa,j,o,Ma){var Da=a,h=e,p=f-a,q=l-e,m,f=f-a,d=d-e,i=i-a,l=l-e,a=e=0,oa=oa-k,pa=pa-n,j=j-k,o=o-n,r=i*d-f*l,u=(j*d-oa*l)/r,t=(o*d-pa*l)/r,oa=(oa*i-j*f)/r,pa=(pa*i-o*f)/r;b.save();b.setTransform(u,t,oa,pa,k,n);dc&&(b.beginPath(),m=1==C?1:0,Ma?(b.moveTo(a-2*m,e-m),b.lineTo(f+m,d-m),b.lineTo(i+m,l+2*m)):(b.moveTo(a-m,e-2*m),b.lineTo(f+2*m,d+m),b.lineTo(i-m,l+m)),
b.closePath(),b.clip());try{m=1==C?10/g/v:0,p=Math.min(p+m,c.width-Da),q=Math.min(q+m,c.height-h),b.drawImage(c,Da,h,p,q,0,0,p,q)}catch(s){}b.restore()}function Dc(a,c){var a=Math.round(a),f=Tc(a),d=0==a%90;b.save();b.globalAlpha=C;b.font=(d?"20px":"14px")+" sans-serif";b.textBaseline="bottom";b.lineWidth=4;b.fillStyle=d?"#ff0":"#fff";b.strokeStyle="#222";b.beginPath();b.rect(c,e.height-14,1.5,e.height-1);b.stroke();b.fill();b.strokeText(f,c+4,e.height+0.5);b.fillText(f,c+4,e.height);b.restore()}
function Tc(a){switch(a){case 0:case 360:return"N";case 90:return"E";case 180:return"S";case 270:return"W";default:return 10>a?"00"+a:100>a?"0"+a:""+a}}function Bc(){var a=H.mouseOver();if(fc!=a)return fc=a,!0;a=gc();return ec!=a?(ec=a,!0):!1}function gc(){return!z||!H.visible?!1:Aa}function Uc(a){sa=new Image;sa.onload=function(){i()};sa.src=a}function Vc(a){Ta=new Image;Ta.onload=function(){i()};Ta.src=a}function hc(){if(!da||!ba)return null;for(var a=0;a<ba.length;a++){var b=ba[a];if(b&&b.isUnderCursor())return b}return null}
function Gc(a){var b=document.createElement("canvas"),c=b.width=b.height=ga,d=b.getContext("2d");d.setTransform(1,0,0,1,ga/2,ga/2);d.beginPath();d.arc(0,0,c/2-2,0,2*Math.PI,!1);d.lineWidth=2;var e=d.createLinearGradient(0,-c/2,0,c/2);e.addColorStop(0,"#f88");e.addColorStop(1,"#a00");d.fillStyle=e;d.stroke();d.fill();d.beginPath();d.arc(0,0,0.4*c,0,2*Math.PI,!1);d.fillStyle="#f00";d.fill();d.strokeStyle=d.fillStyle="#fff";d.lineCap="round";d.lineJoin="round";d.lineWidth=7;d.shadowBlur=4;d.shadowColor=
"#444";a?(d.beginPath(),d.moveTo(-15,-15),d.lineTo(15,0),d.lineTo(-15,15)):(d.beginPath(),d.moveTo(-12,-4),d.lineTo(0,-4),d.lineTo(0,20),d.moveTo(-14,20),d.lineTo(14,20),d.stroke(),d.beginPath(),d.arc(-2,-20,2.5,0,2*Math.PI,!1));d.stroke();return b}function ta(a){var b=e,c=parseInt(e.style.borderLeftWidth);isNaN(c)&&(c=0);var d=parseInt(e.style.borderTopWidth);for(isNaN(d)&&(d=0);"BODY"!=b.tagName;)d+=b.offsetTop,c+=b.offsetLeft,b=b.offsetParent;p=a.clientX-c+window.pageXOffset;q=a.clientY-d+window.pageYOffset}
function M(a){if(!ic&&e&&a)e.style.cursor="url("+a+"),move",e.width=e.width}function N(){if(e){var a;R==$a||R==cb?a="auto":R==bb?a="wait":z?0>A&&H.getFunctionUnderCursor()&&!$?a="pointer":(a=hc())&&a.isLink()&&!$?a="pointer":J?(a=0<=A?ia:gb,a=(a?"url("+a+"),":"")+"auto",ic&&(a="auto")):(a=0<=A?fb:Ba,a=(a?"url("+a+"),":"")+"move",ic&&(a="move")):a="auto";e.style.cursor=a}}function rc(a){G();e.removeEventListener("touchstart",ua,!1);document.removeEventListener("touchmove",Z,!1);document.removeEventListener("touchend",
Fa,!1);e.removeEventListener("MSPointerDown",ua,!1);document.removeEventListener("MSPointerMove",Z,!1);document.removeEventListener("MSPointerUp",Fa,!1);e.removeEventListener("MozTouchDown",ua,!1);document.removeEventListener("MozTouchMove",Z,!1);document.removeEventListener("MozTouchUp",Fa,!1);e.removeEventListener("dblclick",Hc,!1);e.removeEventListener("mousedown",jc,!1);document.removeEventListener("mouseup",Ua,!1);document.removeEventListener("mouseout",Ua,!1);document.removeEventListener("mousemove",
kc,!1);e.removeEventListener("mousewheel",va,!1);e.removeEventListener("DOMMouseScroll",va,!1);($=a&&(wa||Va||Wa))?wa?(e.addEventListener("touchstart",ua,!1),document.addEventListener("touchmove",Z,!1),document.addEventListener("touchend",Fa,!1)):Va?(e.addEventListener("MSPointerDown",ua,!1),document.addEventListener("MSPointerMove",Z,!1),document.addEventListener("MSPointerUp",Fa,!1)):Wa&&(e.addEventListener("MozTouchDown",ua,!1),document.addEventListener("MozTouchMove",Z,!1),document.addEventListener("MozTouchUp",
Fa,!1)):(e.addEventListener("dblclick",Hc,!1),e.addEventListener("mousedown",jc,!1),document.addEventListener("mouseup",Ua,!1),document.addEventListener("mouseout",Ua,!1),document.addEventListener("mousemove",kc,!1),e.addEventListener("mousewheel",va,!1),e.addEventListener("DOMMouseScroll",va,!1))}function Lc(a){if(!(!z||!m()||-1!=A))switch(a.which){case 37:case 177:a.shiftKey?r(l-ha,null):(r(0,0),la(-1/Math.sqrt(g),0));break;case 39:case 176:a.shiftKey?r(l+ha,null):(r(0,0),la(1/Math.sqrt(g),0));
break;case 38:a.shiftKey?r(null,n+ha):(r(0,0),la(0,1/Math.sqrt(g)));break;case 40:a.shiftKey?r(null,n-ha):(r(0,0),la(0,-1/Math.sqrt(g)));break;case 27:case 178:r(0,0);break;case 179:hb();break;case 107:case 187:case 175:a.ctrlKey||(a.shiftKey?ma(za):ma(F));break;case 109:case 189:case 174:a.ctrlKey||(a.shiftKey?ma(1/za):ma(1/F));break;case 49:case 97:I(1);break;case 50:case 98:I(2);break;case 53:case 101:I(0.5);break;case 65:I(0);break;case 77:J=!J;N();break;case 67:jb=!jb;i();break;case 72:da=!da;
i();break;case 73:Bb()}}function Hc(a){z&&m()&&!$&&1==a.which&&!a.shiftKey&&!a.ctrlKey&&!a.altKey&&(0<=H.mouseOver()||xa&&xa())}function jc(a){if(z&&m()&&(ta(a),!(0>p||p>=e.width||0>q||q>=e.height||a.which&&1!=a.which)&&!a.shiftKey&&!a.ctrlKey&&!a.altKey)){W=D=0;C=1;var b=H.getFunctionUnderCursor();b?(A=ea=-1,K=null,fc=-1,window.setTimeout(b,10),H.paint()):(G(),A=p,ea=q,K=a.pointerId?a.pointerId:a.streamId?a.streamId:a.identifier,J&&(Gb=j,ya=k),i())}}function Ua(a){if(z&&m()&&Ic(a)&&(ta(a),!(a.which&&
1!=a.which)&&!(0>A)&&(!a.type||!("mouseout"==a.type&&(0>p||p>=e.width||0>q||q>=e.height))))){K=null;a=A==p&&ea==q;A=ea=-1;K=null;N();var b;a&&(b=hc())&&b.isLink()?(b.gotoUrl(),Gb=ya=-1):(0!=Sa&&(0!=l||0!=n)?ja=Q():l=n=0,Gb=ya=-1,a&&Xa&&Xa())}}function kc(a){if(z&&m()&&Ic(a)){var b=p,f=q;ta(a);var d=Q()-ac;ac=Q();0<=A?(document.selection&&document.selection.empty&&document.selection.empty(),e.focus(),a=c.horzFov/c.width/g,J?(j=Gb-(p-A)*a,k=ya+(q-ea)*a,l/=1.2*a,n/=1.2*a,d&&(l+=100*((b-p)/d),n-=100*
((f-q)/d)),l*=a,n*=a):(b=p-A,f=q-ea,l=b*Math.max(Math.abs(b),100)*zb*a,n=-f*Math.max(Math.abs(f),100)*zb*a),Ec(),Ya&&Ya()):Bc()?i():(a=hc(),a!=Db&&(Db=a,i()));N()}}function va(a){if(!(!z||!m()||-1!=A)&&!a.ctrlKey&&!a.altKey){var b=a.shiftKey?za:F;e.focus();ta(a);var c=0<=(a.detail?-120*a.detail:a.wheelDelta);lc&&(c=!c);var d=0==W?g:O,b=d*(c?b:1/b);0==Ca&&Xb(d,b);P=!0;I(b);a.preventDefault()}}function ua(a){var b=mc(a);jc(b);b.target==e&&a.preventDefault()}function Z(a){var b=mc(a);kc(b);b.target==
e&&a.preventDefault()}function Fa(a){var b=mc(a);Ua(b);b.target==e&&a.preventDefault()}function mc(a){return wa?a.changedTouches[0]:Va||Wa?a:null}function Ic(a){if(!$)return!0;if(!K)return!1;a=a.pointerId?a.pointerId:a.streamId?a.streamId:a.identifier;if(!a||a==K)return!0;K=null;return!1}function Jc(a,b){vb?(e.width=document.body.clientWidth,e.height=document.body.clientHeight):(e.width=a,e.height=b);var c=Ca;Ca=0;I(mb?0:g);Ca=c;H.create();i()}function eb(){Jc(e.clientWidth,e.clientHeight)}function sc(){if(vb){var a=
document.getElementsByTagName("html")[0].style,b=document.getElementsByTagName("body")[0].style;a.height="100%";a.overflow="hidden";b.height="100%";b.overflow="hidden";b.margin="0";eb()}}function Nc(a){function c(){if(!da)return null;var a=Ac(d,l);if(!a)return null;var b=j&&j.src?j.width:ga,b=b*(Math.log(10*g)/5),f=j&&j.src?j.height:ga,f=f*(Math.log(10*g)/5);a.x-=b/2;a.y-=f/2;return 0>a.x+b||a.x>e.width||0>a.y+f||a.y>e.height?null:new Ob(a.x,a.y,b,f)}function f(){return k?!0:!1}this.isUnderCursor=
function(){var a=c();return!a||p<a.x||p>a.x+a.cx||q<a.y||q>a.y+a.cy?!1:!0};this.gotoUrl=function(){if(k)if("_self"==n)window.location.href=k;else{var a=self.open(k,n);a&&a.focus()}};this.isLink=f;this.paint=function(){var a=c();if(a)b.shadowColor="#444",b.shadowBlur=20*(Math.log(10*g)/5),j&&b.drawImage(j,a.x,a.y,a.cx,a.cy),b.shadowBlur=0};this.paintPopup=function(){b.save();b.globalAlpha=1;b.shadowColor="#444";b.shadowBlur=3;b.shadowOffsetX=1;b.shadowOffsetY=2;b.font="14px sans-serif";var a=b.measureText(m),
a=new Ob(p-8,q+16,a.width+10,20);if(0>a.x)a.x=0;else if(a.x>e.width-a.cx)a.x=e.width-a.cx;if(0>a.y)a.y=0;else if(a.y>e.height-a.cy)a.y=e.height-a.cy;b.strokeStyle="#008";b.lineWidth=2;var c=b.createLinearGradient(a.x,a.y,a.x,a.y+a.cy);c.addColorStop(0,"#fff");c.addColorStop(1,"#bbb");b.fillStyle=c;Kc(a,2);b.stroke();b.fill();b.shadowBlur=0;b.shadowOffsetX=0;b.shadowOffsetY=0;b.fillStyle="#008";b.textAlign="center";b.textBaseline="middle";b.fillText(m,a.x+a.cx/2,a.y+a.cy/2);b.restore()};var d=a.pan?
Number(a.pan):0,l=a.tilt?Number(a.tilt):0,m=a.text?a.text:"???",k=a.url?a.url:null,n=a.target?a.target:"_self";Object.defineProperty(this,"pan",{set:function(a){d=a;i()},get:function(){return d}});Object.defineProperty(this,"tilt",{set:function(a){l=a;i()},get:function(){return l}});Object.defineProperty(this,"text",{set:function(a){m=a},get:function(){return m}});Object.defineProperty(this,"url",{set:function(a){k=a},get:function(){return k}});Object.defineProperty(this,"target",{set:function(a){n=
a},get:function(){return n}});var j;a.image?(j=new Image,j.src=a.img):j=f()?Ta:sa}function t(a){return Math.cos(a*B)}function La(a){return Math.tan(a*B)}function na(a,b){return Math.atan2(a,b)*L}function ka(a,b,c){return a<=b?b:a>=c?c:a}function Kc(a,c){var e=a.x+a.cx,d=a.y+a.cy;b.beginPath();b.moveTo(a.x+c,a.y);b.lineTo(e-c,a.y);b.quadraticCurveTo(e,a.y,e,a.y+c);b.lineTo(e,a.y+a.cy-c);b.quadraticCurveTo(e,d,e-c,d);b.lineTo(a.x+c,d);b.quadraticCurveTo(a.x,d,a.x,d-c);b.lineTo(a.x,a.y+c);b.quadraticCurveTo(a.x,
a.y,a.x+c,a.y)}function zc(a,b){this.x=a;this.y=b}function Ob(a,b,c,e){this.x=a;this.y=b;this.cx=c;this.cy=e}function Rc(a,b){this.pan=a;this.tilt=b;this.yDisp=this.xDisp=0;this.valid=!1}wb="1.0.1.41";oc="(c) 2012 by Karl Maloszek - Simple Software\n(http://www.panorado.com)";Wb=!1;B=Math.PI/180;L=180/Math.PI;ab=1;u=2;pc=3;ha=3;fa=60;db=0.25;Ab=8;F=Math.SQRT2;za=Math.sqrt(Math.sqrt(Math.sqrt(Math.SQRT2)));xb=103;yb=70.5;zb=0.04;ga=96;V=30;$a=0;bb=1;cb=2;Mb=3;this.about=Bb;this.reset=hb;this.move=
la;this.moveTo=wc;this.zoom=ma;this.zoomToCursor=function(a){P=!0;I(g*a)};this.setSpeed=r;this.checkPaint=Ec;this.resize=Jc;this.selectImage=tc;this.nextImage=Ia;if(!window._VIEWERS)window._VIEWERS=[];var Fc=window._VIEWERS.length;window._VIEWERS[Fc]=this;var Za=navigator.userAgent,Wc=0<=Za.indexOf("MSIE"),ic=0<=Za.indexOf("Chrome");Za.indexOf("Firefox");Za.indexOf("Safari");Za.indexOf("Opera");var dc=Wc;try{Object.defineProperty(this,"version",{get:function(){return wb}})}catch(Xc){return}var e=
null;Object.defineProperty(this,"canvas",{set:function(a){qc(a);i()},get:function(){return e}});var b=null,vb=!1;Object.defineProperty(this,"fullWindow",{set:function(a){vb=a;sc()},get:function(){return vb}});var aa=null;Object.defineProperty(this,"imageList",{set:function(a){aa=a;X=-1;H.create()},get:function(){return aa}});var X=-1,c=null;Object.defineProperty(this,"image",{set:function(a){uc(a)},get:function(){return c}});var x=ab;Object.defineProperty(this,"projection",{set:function(a){x="spherical"==
a?u:ab;i()},get:function(){return x==u?"spherical":"flat"}});Object.defineProperty(this,"useWebGL",{set:function(){},get:function(){return!1}});var s=null,cc=5,v;Object.defineProperty(this,"gridSize",{set:function(a){cc=ka(a,1,8);i()},get:function(){return cc}});var Eb=db,Yb=Ab,z=!0;Object.defineProperty(this,"enabled",{set:function(a){z=a?!0:!1},get:function(){return z}});var wa=!1;try{document.createEvent("TouchEvent"),wa=!0}catch(Yc){}var Va=!1;try{document.createEvent("MsPointerEvent"),Va=!0}catch(Zc){}var Wa=
!1;try{document.createEvent("MozTouchEvent"),Wa=!0}catch($c){}var $=!1;Object.defineProperty(this,"useTouch",{set:function(a){rc(a)},get:function(){return $}});var J=$;Object.defineProperty(this,"mouseMode",{set:function(a){J="grab"==a;N()},get:function(){return J?"grab":"pan"}});var lc=!1;Object.defineProperty(this,"mouseWheel",{set:function(a){lc="in"==a},get:function(){return lc?"in":"out"}});var Ba,fb,gb,ia;Object.defineProperty(this,"panCursor0",{set:function(a){M(a);Ba=a;N()},get:function(){return Ba}});
Object.defineProperty(this,"panCursor1",{set:function(a){M(a);fb=a;N()},get:function(){return fb}});Object.defineProperty(this,"grabCursor0",{set:function(a){M(a);gb=a;N()},get:function(){return gb}});Object.defineProperty(this,"grabCursor1",{set:function(a){M(a);ia=a;N()},get:function(){return ia}});var Sa=2;Object.defineProperty(this,"softPan",{set:function(a){Sa=ka(a,0,5)},get:function(){return Sa}});var Ca=3;Object.defineProperty(this,"softZoom",{set:function(a){Ca=ka(a,0,5)},get:function(){return Ca}});
var Ra=0.5;Object.defineProperty(this,"softFade",{set:function(a){Ra=ka(a,0,10)},get:function(){return Ra}});var R=$a;Object.defineProperty(this,"loaded",{get:function(){return m()}});var vc=!0,j;Object.defineProperty(this,"pan",{set:function(a){m()&&(G(),j=Ja(a),i())},get:function(){return m()?j:0}});var k;Object.defineProperty(this,"tilt",{set:function(a){m()&&(G(),k=Ka(a),i())},get:function(){return m()?k:0}});var g=1;Object.defineProperty(this,"scale",{set:function(a){P=!1;I(a)},get:function(){return g}});
var mb=!1;Object.defineProperty(this,"panSpeed",{set:function(a){r(a,null)},get:function(){return m()?l:0}});Object.defineProperty(this,"tiltSpeed",{set:function(a){r(null,a)},get:function(){return m()?n:0}});Object.defineProperty(this,"mousePan",{get:function(){return m()?Zb(g):0}});Object.defineProperty(this,"mouseTilt",{get:function(){return m()?$b(g):0}});var Ha=0,C=0,D,w,l=0,n=0,Gb=-1,ya=-1,ja=0,W=0,Cb=0,O=0,ac=0,p=-1,q=-1,A=-1,ea=-1,K=null,Aa=!1,P=!1,lb=null,Xa=null,xa=null,Ya=null,Vb=null;
Object.defineProperty(this,"onImageLoaded",{set:function(a){lb=a},get:function(){return lb}});Object.defineProperty(this,"onClick",{set:function(a){Xa=a},get:function(){return Xa}});Object.defineProperty(this,"onDblClick",{set:function(a){xa=a},get:function(){return xa}});Object.defineProperty(this,"onMouseMove",{set:function(a){Ya=a},get:function(){return Ya}});Object.defineProperty(this,"onImageMove",{set:function(a){Vb=a},get:function(){return Vb}});var jb=!1;Object.defineProperty(this,"compassVisible",
{set:function(a){jb=a;i()},get:function(){return jb}});var da=!0;Object.defineProperty(this,"hotspotsVisible",{set:function(a){da=a;i()},get:function(){return da}});var sa=Gc(!1),Ta=Gc(!0);Object.defineProperty(this,"hotspotInfo",{set:function(a){Uc(a)},get:function(){return sa.src}});Object.defineProperty(this,"hotspotLink",{set:function(a){Vc(a)},get:function(){return Ta.src}});var ba=null,Db=null,Kb=null,H=new function(){function a(){if(e){o=[];var a=1.1*V*c,f=1.5*V*c,h=10+a/2;d&&(o.push({x:h,
fnPaint:function(){b.beginPath();b.moveTo(-4,-4);b.lineTo(4,0);b.lineTo(-4,4);b.closePath();b.stroke()},fnClick:function(){hb()}}),h+=f);j&&(o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-4,0);b.lineTo(4,0);b.stroke()},fnClick:function(){ma(1/F)},fnEnabled:function(){return g>db}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-4,-1);b.lineTo(0,-4);b.lineTo(0,6);b.stroke()},fnClick:function(){I(1)},fnHilight:function(){return 1==g}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();
b.strokeRect(-4,-4,8,8)},fnClick:function(){I(0)},fnHilight:function(){return mb}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-4,0);b.lineTo(4,0);b.moveTo(0,-4);b.lineTo(0,4);b.stroke()},fnClick:function(){ma(F)},fnEnabled:function(){return g<Ab}}),h+=f);k&&(o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(3,-3);b.lineTo(-3,0);b.lineTo(3,3);b.stroke()},fnClick:function(){r(l-2,null)}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-3,-4);b.lineTo(-3,4);b.moveTo(3,
-4);b.lineTo(3,4);b.stroke()},fnClick:function(){r(0,0)},fnEnabled:function(){return 0!=l||0!=n}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-3,-3);b.lineTo(3,0);b.lineTo(-3,3);b.stroke()},fnClick:function(){r(l+2,null)}}),h+=f);m&&aa&&(o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-3,-3);b.lineTo(-9,0);b.lineTo(-3,3);b.stroke();b.strokeRect(1,-4,8,8)},fnClick:function(){Ia(-1)},fnEnabled:function(){return 0<X}}),h+=a,o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(3,
-3);b.lineTo(9,0);b.lineTo(3,3);b.stroke();b.strokeRect(-9,-4,8,8)},fnClick:function(){Ia(1)},fnEnabled:function(){return X<aa.length-1}}),h+=f);u&&ba&&(o.push({x:h,fnPaint:function(){b.beginPath();b.arc(0,0,4,0,2*Math.PI,!0);b.moveTo(-7,0);b.lineTo(7,0);b.moveTo(0,-7);b.lineTo(0,7);b.stroke()},fnClick:function(){da=!da;i()},fnHilight:function(){return da}}),h+=a);t&&(o.push({x:h,fnPaint:function(){b.fillText("?",0,6)},fnClick:function(){(s=self.open(t,"ViewerHelp","width=500,height=500,location=no,menubar=no,scrollbars=no,resizable=yes,status=no,toolbar=no,titlebar=yes"))&&
s.focus()}}),h+=a);o.push({x:h,fnPaint:function(){b.beginPath();b.moveTo(-3,-1);b.lineTo(0,-1);b.lineTo(0,5);b.moveTo(-4,5);b.lineTo(4,5);b.stroke();b.beginPath();b.arc(-0.5,-5,0.7,0,2*Math.PI,!0);b.stroke()},fnClick:function(){Bb()}});v&&self.opener&&o.push({x:h+a,fnPaint:function(){b.beginPath();b.moveTo(0,-7);b.lineTo(0,3);b.stroke();b.beginPath();b.arc(0,1,5,225*Math.PI/180,315*Math.PI/180,!0);b.stroke()},fnClick:function(){s&&!s.closed&&(s.close(),s=null);window.close()}})}}this.getFunctionUnderCursor=
function(){if(!gc()||!o)return null;var a=V*c/2,b=20*c/2,d=e.height-10-b;if(!(q>=d-b&&q<=d+b))return null;for(b=0;b<o.length;b++)if(d=o[b],p>=d.x-a&&p<=d.x+a)if(d.fnEnabled){if(d.fnEnabled())return d.fnClick;break}else return d.fnClick;return null};this.mouseOver=function(){if(!gc()||!o||!Aa)return-1;var a=V*c/2,b=20*c/2,d=e.height-10-b;if(!(q>=d-b&&q<=d+b))return-1;for(b=0;b<o.length;b++)if(d=o[b],p>=d.x-a&&p<=d.x+a)return b;return-1};this.paint=function(){if(o){b.save();b.globalAlpha=1;b.shadowColor=
"#000";b.shadowBlur=1.5;b.shadowOffsetX=1;b.shadowOffsetY=2;b.font="bold 16px sans-serif";b.textAlign="center";b.textBaseline="alphabetic";b.lineWidth=1.5;b.lineCap="round";b.lineJoin="round";b.fillStyle="#fff";b.strokeStyle="#fff";for(var a=e.height-10-20*c/2,d=0;d<o.length;d++){var f=o[d],g=f.x,i=!f.fnEnabled||f.fnEnabled();b.setTransform(c,0,0,c,g,a);b.save();b.fillStyle=f.fnHilight&&f.fnHilight()?"rgba(128, 170, 255, 0.4)":"rgba(24, 32, 48, 0.4)";b.lineWidth=i?2:1.01;g=new Ob(-V/2,-10,V,20);Kc(g,
4);b.fill();b.stroke();b.restore();b.lineWidth=1.5;f.fnPaint()}b.restore()}};this.create=a;var c=1;Object.defineProperty(this,"size",{set:function(a){c=ka(a,0.7,2);H.create()},get:function(){return c}});var f=!0,d=!0,j=!0,k=!0,m=!0,u=!0,t="",s=null,v=!0;Object.defineProperty(this,"visible",{set:function(a){f=a;i()},get:function(){return f}});Object.defineProperty(this,"reset",{set:function(b){d=b;a()},get:function(){return d}});Object.defineProperty(this,"scale",{set:function(b){j=b;a()},get:function(){return j}});
Object.defineProperty(this,"motion",{set:function(b){k=b;a()},get:function(){return k}});Object.defineProperty(this,"hotspots",{set:function(b){u=b;a()},get:function(){return u}});Object.defineProperty(this,"browse",{set:function(b){m=b;a()},get:function(){return m}});Object.defineProperty(this,"helpUrl",{set:function(b){t=b;a()},get:function(){return t}});Object.defineProperty(this,"closeWindow",{set:function(b){v=b;a()},get:function(){return v}});var o=null;a()};this.controls=H;var ec=!1,fc=-1;
nc&&qc(nc)};
